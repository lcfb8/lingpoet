<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wander — LingPoet</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500&display=swap"
      rel="stylesheet"
    >
  </head>

  <body>
    <!-- Top Navigation (MATCHES HOMEPAGE HEADER STRUCTURE) -->
    <header class="topbar">
      <nav class="nav" aria-label="Primary navigation">
        <!-- Left: search icon placeholder -->
        <a class="nav__icon" href="#" aria-label="Search">⌕</a>

        <!-- Center brand -->
        <a class="nav__brand" href="../index.html">LINGPOET</a>

        <!-- Center links -->
        <ul class="nav__links">
          <li><a href="../index.html">Behind the Words</a></li>
          <li><a href="index.html" class="active" aria-current="page">Wander</a></li>
          <li><a href="../words-studio/search.html">Words Studio</a></li>
          <li><a href="../who-we-are/index.html">Who We Are</a></li>
        </ul>
      </nav>
    </header>

    <main class="page">

      <!-- Intro -->
      <section class="intro" aria-labelledby="wander-title">
        <!--<p class="kicker">Explore words and sounds that randomly connect across languages</p>-->
        <h1 id="wander-title">Explore words and sounds that randomly connect across languages</h1>
        <p class="lede">
          Fun facts, unexpected word pairs, tiny poems, and a sneak peek into the dataset behind LingPoet.
          We’re not chasing shared roots — just delightful accidents.
          As linguists, we are interested in all words, even those that may be considered slang, informal, or vulgar.
        </p>
      </section>

      <!-- 1) Quirky fun fact -->
      <section class="panel" aria-labelledby="funfact-title">
        <div class="panel__inner split">
          <figure class="media">
            <img src="../images/glad_rooster.jpg" alt="A sign reading 'glad rooster'">
            <figcaption class="caption">
              The Hague, Netherlands. Photo: Lydia Brosnahan.
            </figcaption>
          </figure>

          <div class="text">
            <h2 id="funfact-title"><b>A sign, two worlds</b></h2>
            <p>
              This is a classic LingPoet moment: your eyes read a familiar phrase, your brain nods politely,
              and then another language interprets the same letters as something else entirely.
            </p>
            <p class="note">
              <strong>Our filter:</strong> we avoid etymological relatives and loanwords.
              We keep the pairs that match by coincidence (and comedic timing).
            </p>
            <p>
              A sign that looks perfectly normal in English — until another language walks in.
              This sign could either be welcoming you to a happy poultry farm in English, or warning cyclists in Dutch about a grate of metal bars in the path ahead.
            </p>
          </div>
        </div>
      </section>

      <!-- 2) Norwegian–English pairs -->
      <section class="section" aria-labelledby="pairs-title">
        <header class="section__header">
          <h2 id="pairs-title">Some interesting word pairs in Norwegian and English</h2>
            <p class="section__lede">
            Same spelling. Different meanings. Pure coincidence — and occasionally, chaos.
            </p>
        </header>

      <div class="pairs-table" role="table" aria-label="Norwegian and English word pairs">
        <div class="pairs-row pairs-head" role="row">
          <div class="pairs-cell" role="columnheader">Word</div>
          <div class="pairs-cell" role="columnheader">Meaning in English</div>
          <div class="pairs-cell" role="columnheader">Meaning in Norwegian</div>
        </div>

        <div class="pairs-row" role="row">
          <div class="pairs-cell pairs-word" role="cell">dust</div>
          <div class="pairs-cell" role="cell">powder of small particles</div>
          <div class="pairs-cell" role="cell">slang for a jerk</div>
        </div>

        <div class="pairs-row" role="row">
          <div class="pairs-cell pairs-word" role="cell">smell</div>
          <div class="pairs-cell" role="cell">odor</div>
          <div class="pairs-cell" role="cell">loud sound</div>
        </div>

        <div class="pairs-row" role="row">
          <div class="pairs-cell pairs-word" role="cell">karen</div>
          <div class="pairs-cell" role="cell">woman's name</div>
          <div class="pairs-cell" role="cell">the guy</div>
        </div>

        <div class="pairs-row" role="row">
          <div class="pairs-cell pairs-word" role="cell">bra</div>
          <div class="pairs-cell" role="cell">woman's undergarment</div>
          <div class="pairs-cell" role="cell">good</div>
        </div>

        <div class="pairs-row" role="row">
          <div class="pairs-cell pairs-word" role="cell">god</div>
          <div class="pairs-cell" role="cell">deity</div>
          <div class="pairs-cell" role="cell">good</div>
        </div>

        <div class="pairs-row" role="row">
          <div class="pairs-cell pairs-word" role="cell">time</div>
          <div class="pairs-cell" role="cell">time</div>
          <div class="pairs-cell" role="cell">hour</div>
        </div>

        <div class="pairs-row" role="row">
          <div class="pairs-cell pairs-word" role="cell">her</div>
          <div class="pairs-cell" role="cell">female pronoun</div>
          <div class="pairs-cell" role="cell">here</div>
        </div>

        <div class="pairs-row" role="row">
          <div class="pairs-cell pairs-word" role="cell">gate</div>
          <div class="pairs-cell" role="cell">door or portal</div>
          <div class="pairs-cell" role="cell">street</div>
        </div>

        <div class="pairs-row" role="row">
          <div class="pairs-cell pairs-word" role="cell">gift</div>
          <div class="pairs-cell" role="cell">present</div>
          <div class="pairs-cell" role="cell">poison or married</div>
        </div>
      </div>

      <aside class="pairs-note" aria-label="Fun linguistic aside">
        <p class="pairs-aside__label"><b>A small linguistic cameo</b></p>

        <p class="pairs-aside__text">
        The hit Norwegian TV show <em>SKAM</em> ends with a title screen that reads
        <em>Alt Er Love</em> — “Everything is Love” — borrowing the English word <em>love</em>.
        But it’s also a wink at the Norwegian phrase <em>Alt er lov</em> (“everything is allowed”).
        And as if that weren’t enough: <em>lover</em> in Norwegian can mean “to promise.”
        </p>
      </aside>

      </section>

      <!-- 3) Poem example -->
      <section class="panel panel--soft" aria-labelledby="poem-title">
        <div class="panel__inner">
          <header class="section__header">
            <h2 id="poem-title">A small poem experiment</h2>
            <p class="section__lede">
              How do coincidences sound when you let them become a line?
            </p>
          </header>

          <div class="poem">
            <p><em>
            I met you at the <b>gate</b>,<br>
            not a door, but a long street<br>
            where <b>time</b> stretched - <br>
            an hour pretending to be forever.<br>
            <br>
            You smiled; there was a <b>smell</b> in the air,<br>
            not perfume, but thunder,<br>
            and the world went loud<br>
            in the softest way.<br>
            <br>
            You said you <b>lover</b> me - <br>
            a promise, carefully wrapped,<br>
            a <b>gift</b> held out with both hands:<br>
            sweet in one tongue,<br>
            <b>poison</b> in another.<br>
            <br></em>
          </p>
          </div>
        </div>
      </section>

      <!-- 4) Sneak peek (playful + interactive) -->
      <section class="section" aria-labelledby="peek-title">
        <header class="section__header">
          <h2 id="peek-title">Sneak peek: tap to reveal</h2>
          <p class="section__lede">
            Click "Go wander" to surface 6 coincident words that appear in three or more languages in the dataset. Tap a tile to reveal IPA and meanings for up to three languages.
          </p>
        </header>

        <div class="peek-controls peek-controls--center">
          <div class="peek-controls__row" style="justify-content:center;">
            <button id="go-wander" class="pill" disabled>Go wander</button>
            <div id="status" class="muted" style="margin-left:1rem;">Loading database…</div>
          </div>
        </div>

        <div id="peek-grid" class="peek-grid" aria-live="polite" role="list">
          <!-- six tiles injected here -->
        </div>

        <div class="peek-footer">
          <div class="btw__cta" style="width:100%; max-width:950px; margin:0 auto;">
            <div class="btw__cta-text" style="flex:1; min-width:0;">
              <h3 class="card__title" style="margin-bottom:0.25rem;">Come & Play</h3>
              <p class="card__text" style="margin:0;">
                Explore coincidences. Make unexpected connections. Find something funny. Write your own poetry.
              </p>
            </div>
            <div style="margin-left:1rem;">
              <a class="btw__button" href="../words-studio/search.html">Open Words Studio →</a>
            </div>
          </div>
        </div>
      </section>

    </main>

    <!-- Footer (same vibe as homepage) -->
    <footer class="site-footer">
      <div class="site-footer__inner">
        <p>© 2026 LingPoet</p>
        <p>Created at Harvard Kennedy School</p>
      </div>
    </footer>

    <!-- libs: pako for gunzip and sql.js for SQLite parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>
    <script>
      (async function () {
        const DB_URL = "https://dhrumil-public.s3.amazonaws.com/code4policy/coincidences.db.gz";
        const statusEl = document.getElementById("status");
        const goBtn = document.getElementById("go-wander");
        const grid = document.getElementById("peek-grid");
        let dataset = []; // rows read from DB only

        const setStatus = (s) => { if (statusEl) statusEl.textContent = s; };

        try {
          setStatus("Fetching database…");
          const resp = await fetch(DB_URL);
          const ab = await resp.arrayBuffer();
          setStatus("Decompressing…");
          const u8 = pako.ungzip(new Uint8Array(ab));
          setStatus("Loading SQL engine…");
          const SQL = await initSqlJs({ locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/${file}` });
          const db = new SQL.Database(u8);

          setStatus("Discovering tables…");
          const tablesRes = db.exec("SELECT name FROM sqlite_master WHERE type='table'");
          const tables = (tablesRes[0] && tablesRes[0].values) ? tablesRes[0].values.map(r => r[0]) : [];

          function detectCols(table) {
            try {
              const info = db.exec(`PRAGMA table_info("${table}")`);
              if (!info[0]) return null;
              const cols = info[0].values.map(r => r[1].toLowerCase());
              const find = (rx) => cols.find(c => c.match(rx));
              return {
                word: find(/word|token|lemma|entry/),
                ipa: find(/ipa|pron|pronunciation/),
                lang: find(/lang|language|iso|locale/),
                meaning: find(/meaning|definition|gloss|translation|def/)
              };
            } catch (e) { return null; }
          }

          // Read rows from all usable tables (no hardcoded dataset)
          for (const t of tables) {
            const cols = detectCols(t);
            if (!cols || !cols.word) continue;
            const selCols = [cols.word, cols.ipa, cols.lang, cols.meaning].filter(Boolean).map(c => `"${c}"`).join(", ");
            try {
              const rowsRes = db.exec(`SELECT ${selCols} FROM "${t}" LIMIT 20000`);
              if (!rowsRes[0]) continue;
              const colNames = rowsRes[0].columns.map(c => c.toLowerCase());
              for (const row of rowsRes[0].values) {
                const obj = {};
                for (let i = 0; i < colNames.length; i++) obj[colNames[i]] = row[i];
                dataset.push({
                  word: obj[colNames.find(n=>n.match(/word|token|lemma|entry/))] || "",
                  ipa: obj[colNames.find(n=>n.match(/ipa|pron/))] || "",
                  language: String(obj[colNames.find(n=>n.match(/lang|language|iso|locale/))] || ""),
                  meaning: obj[colNames.find(n=>n.match(/meaning|definition|gloss|translation|def/))] || ""
                });
              }
            } catch (e) { /* ignore table read errors */ }
          }

          if (dataset.length === 0) {
            setStatus("Database read succeeded but no usable rows found.");
            goBtn.disabled = true;
            return;
          }

          // index by word and collect language sets
          const byWord = {};
          for (const r of dataset) {
            if (!r.word) continue;
            byWord[r.word] = byWord[r.word] || { rows: [], langs: new Set() };
            byWord[r.word].rows.push(r);
            if (r.language) byWord[r.word].langs.add(String(r.language));
          }

          // candidates: words present in >=3 distinct languages
          const primaryCandidates = Object.entries(byWord).filter(([w,v]) => v.langs.size >= 3).map(([w]) => w);
          // secondary: >=2 languages
          const secondaryCandidates = Object.entries(byWord).filter(([w,v]) => v.langs.size === 2).map(([w]) => w);
          // fallback: any word
          const allWords = Object.keys(byWord);

          function shuffle(a){ for (let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }

          function pickRandomWords() {
            const chosen = [];
            const p = shuffle(primaryCandidates.slice());
            for (const w of p) { if (chosen.length===6) break; chosen.push(w); }
            if (chosen.length < 6) {
              const s = shuffle(secondaryCandidates.slice());
              for (const w of s) { if (chosen.length===6) break; if (!chosen.includes(w)) chosen.push(w); }
            }
            if (chosen.length < 6) {
              const rest = shuffle(allWords.slice());
              for (const w of rest) { if (chosen.length===6) break; if (!chosen.includes(w)) chosen.push(w); }
            }
            return chosen.slice(0,6).map(w => ({ word: w }));
          }

          function renderTiles(items){
            grid.innerHTML = "";
            for (const it of items) {
              const details = document.createElement("details");
              details.className = "peek";
              const summary = document.createElement("summary");
              summary.className = "peek__front";
              const wordSpan = document.createElement("span");
              wordSpan.className = "peek__word";
              wordSpan.textContent = it.word || "—";
              const hint = document.createElement("span");
              hint.className = "peek__hint";
              hint.textContent = "tap to reveal";
              summary.appendChild(wordSpan);
              summary.appendChild(hint);
              details.appendChild(summary);

              const back = document.createElement("div");
              back.className = "peek__back";

              const info = byWord[it.word] || { rows: [], langs: new Set() };
              const langs = Array.from(info.langs).slice(0,3);
              if (langs.length === 0) {
                back.innerHTML = "<p class='muted'>No entries found for this word.</p>";
              } else {
                for (const lang of langs) {
                  const rows = info.rows.filter(r => String(r.language) === String(lang));
                  const wrapper = document.createElement("div");
                  wrapper.className = "meaning-row";
                  const langLabel = document.createElement("div");
                  langLabel.className = "meaning-lang";
                  langLabel.textContent = lang;
                  wrapper.appendChild(langLabel);

                  const ipas = Array.from(new Set(rows.map(r=>r.ipa).filter(Boolean)));
                  const meanings = Array.from(new Set(rows.map(r=>r.meaning).filter(Boolean)));
                  if (ipas.length) {
                    const ipEl = document.createElement("p");
                    ipEl.innerHTML = "<strong>IPA:</strong> " + ipas.join(" · ");
                    wrapper.appendChild(ipEl);
                  }
                  if (meanings.length) {
                    for (const m of meanings) {
                      const mEl = document.createElement("p");
                      mEl.innerHTML = "<strong>Meaning:</strong> " + m;
                      wrapper.appendChild(mEl);
                    }
                  }
                  if (!ipas.length && !meanings.length) {
                    const p = document.createElement("p");
                    p.innerHTML = "<em class='muted'>No entry</em>";
                    wrapper.appendChild(p);
                  }
                  back.appendChild(wrapper);
                }
              }

              details.appendChild(back);
              grid.appendChild(details);
            }
          }

          // enable Go wander only if at least one primary candidate exists (prefer >=3-lang coincidences)
          const hasPrimary = primaryCandidates.length > 0;
          if (!hasPrimary) setStatus("No words found that appear in 3+ languages — Go wander will still try.");
          else setStatus("Ready. Click Go wander to surface words with coincidences across 3+ languages.");
          goBtn.disabled = false;

          goBtn.addEventListener("click", ()=>{
            setStatus("Generating words…");
            const items = pickRandomWords();
            renderTiles(items);
            setStatus("Tap a tile to reveal IPA and meanings.");
            grid.scrollIntoView({ behavior: "smooth", block: "start" });
          });

        } catch (err) {
          console.error(err);
          setStatus("Failed to load database — Sneak peek disabled.");
          goBtn.disabled = true;
        }
      })();
    </script>
  </body>
</html>
